<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Job Queue | Enqueue Zero</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Enqueue Zero is publishing code principles.">
    <link rel="preload" href="/assets/css/0.styles.37721fd6.css" as="style"><link rel="preload" href="/assets/js/app.0bd1d501.js" as="script"><link rel="preload" href="/assets/js/6.380ebf0c.js" as="script"><link rel="preload" href="/assets/js/30.5b7db60c.js" as="script"><link rel="prefetch" href="/assets/js/1.e0c929f6.js"><link rel="prefetch" href="/assets/js/10.65c246f3.js"><link rel="prefetch" href="/assets/js/100.42bc022c.js"><link rel="prefetch" href="/assets/js/101.b5e0d1ff.js"><link rel="prefetch" href="/assets/js/102.5cd0372e.js"><link rel="prefetch" href="/assets/js/103.2f56b9a2.js"><link rel="prefetch" href="/assets/js/104.b906318a.js"><link rel="prefetch" href="/assets/js/105.1fe22608.js"><link rel="prefetch" href="/assets/js/106.2abe436c.js"><link rel="prefetch" href="/assets/js/107.6f9875d2.js"><link rel="prefetch" href="/assets/js/108.7e984ecf.js"><link rel="prefetch" href="/assets/js/109.e0004694.js"><link rel="prefetch" href="/assets/js/11.87112945.js"><link rel="prefetch" href="/assets/js/110.b2b6620a.js"><link rel="prefetch" href="/assets/js/111.b48f79e5.js"><link rel="prefetch" href="/assets/js/112.466e709c.js"><link rel="prefetch" href="/assets/js/113.208a2737.js"><link rel="prefetch" href="/assets/js/114.227a0d44.js"><link rel="prefetch" href="/assets/js/115.179d320d.js"><link rel="prefetch" href="/assets/js/116.e552502b.js"><link rel="prefetch" href="/assets/js/117.8be14f3a.js"><link rel="prefetch" href="/assets/js/118.fa87138a.js"><link rel="prefetch" href="/assets/js/119.e37d33d8.js"><link rel="prefetch" href="/assets/js/12.3194c411.js"><link rel="prefetch" href="/assets/js/120.e8e10f61.js"><link rel="prefetch" href="/assets/js/121.1df6fca0.js"><link rel="prefetch" href="/assets/js/122.25ba9a0f.js"><link rel="prefetch" href="/assets/js/123.622ec346.js"><link rel="prefetch" href="/assets/js/124.c5bc3c03.js"><link rel="prefetch" href="/assets/js/125.7dbdf891.js"><link rel="prefetch" href="/assets/js/126.8342f743.js"><link rel="prefetch" href="/assets/js/127.469cfcfa.js"><link rel="prefetch" href="/assets/js/128.0cd9c417.js"><link rel="prefetch" href="/assets/js/129.2ac6abf9.js"><link rel="prefetch" href="/assets/js/13.aa511a98.js"><link rel="prefetch" href="/assets/js/130.13b3a85d.js"><link rel="prefetch" href="/assets/js/131.6a4e1940.js"><link rel="prefetch" href="/assets/js/132.a27cb358.js"><link rel="prefetch" href="/assets/js/133.9ed6a0a7.js"><link rel="prefetch" href="/assets/js/134.26978afb.js"><link rel="prefetch" href="/assets/js/135.85848719.js"><link rel="prefetch" href="/assets/js/136.a68d5df6.js"><link rel="prefetch" href="/assets/js/137.fe371a92.js"><link rel="prefetch" href="/assets/js/138.c69379d5.js"><link rel="prefetch" href="/assets/js/139.348e1646.js"><link rel="prefetch" href="/assets/js/14.606d1bea.js"><link rel="prefetch" href="/assets/js/140.3e55afd9.js"><link rel="prefetch" href="/assets/js/141.c522d5bd.js"><link rel="prefetch" href="/assets/js/142.a24a3554.js"><link rel="prefetch" href="/assets/js/143.682b1ac6.js"><link rel="prefetch" href="/assets/js/144.70a59945.js"><link rel="prefetch" href="/assets/js/145.3f37c0df.js"><link rel="prefetch" href="/assets/js/146.ffcc6e57.js"><link rel="prefetch" href="/assets/js/147.759cfc52.js"><link rel="prefetch" href="/assets/js/148.7c30376b.js"><link rel="prefetch" href="/assets/js/149.f7f4ee86.js"><link rel="prefetch" href="/assets/js/15.8a347078.js"><link rel="prefetch" href="/assets/js/150.f469ab8b.js"><link rel="prefetch" href="/assets/js/151.1a435d23.js"><link rel="prefetch" href="/assets/js/152.53447eda.js"><link rel="prefetch" href="/assets/js/153.c6e576ce.js"><link rel="prefetch" href="/assets/js/154.7bd19cc0.js"><link rel="prefetch" href="/assets/js/155.57ede3e1.js"><link rel="prefetch" href="/assets/js/156.94f1bbcb.js"><link rel="prefetch" href="/assets/js/157.00739681.js"><link rel="prefetch" href="/assets/js/158.7e5823cf.js"><link rel="prefetch" href="/assets/js/159.cec7d8d9.js"><link rel="prefetch" href="/assets/js/16.0f6060a6.js"><link rel="prefetch" href="/assets/js/160.985decbf.js"><link rel="prefetch" href="/assets/js/161.ed1f6fff.js"><link rel="prefetch" href="/assets/js/17.8a8db3f8.js"><link rel="prefetch" href="/assets/js/18.c1c32db5.js"><link rel="prefetch" href="/assets/js/19.d86bf541.js"><link rel="prefetch" href="/assets/js/2.d451d784.js"><link rel="prefetch" href="/assets/js/20.761042d8.js"><link rel="prefetch" href="/assets/js/21.989f5a9d.js"><link rel="prefetch" href="/assets/js/22.ddfd889e.js"><link rel="prefetch" href="/assets/js/23.954d5189.js"><link rel="prefetch" href="/assets/js/24.c61f517c.js"><link rel="prefetch" href="/assets/js/25.80a01328.js"><link rel="prefetch" href="/assets/js/26.fd330669.js"><link rel="prefetch" href="/assets/js/27.0a33f2cb.js"><link rel="prefetch" href="/assets/js/28.e21d5b88.js"><link rel="prefetch" href="/assets/js/29.12412ca6.js"><link rel="prefetch" href="/assets/js/3.6ea06ddd.js"><link rel="prefetch" href="/assets/js/31.654806be.js"><link rel="prefetch" href="/assets/js/32.c74b419d.js"><link rel="prefetch" href="/assets/js/33.db58ad63.js"><link rel="prefetch" href="/assets/js/34.02b06862.js"><link rel="prefetch" href="/assets/js/35.f144b75a.js"><link rel="prefetch" href="/assets/js/36.47387362.js"><link rel="prefetch" href="/assets/js/37.9db4d157.js"><link rel="prefetch" href="/assets/js/38.2fc02702.js"><link rel="prefetch" href="/assets/js/39.1dfc6a6c.js"><link rel="prefetch" href="/assets/js/4.1b578b6a.js"><link rel="prefetch" href="/assets/js/40.b6cdd33b.js"><link rel="prefetch" href="/assets/js/41.0ba34ce5.js"><link rel="prefetch" href="/assets/js/42.18b55462.js"><link rel="prefetch" href="/assets/js/43.e619a537.js"><link rel="prefetch" href="/assets/js/44.4bf91d97.js"><link rel="prefetch" href="/assets/js/45.292c54fe.js"><link rel="prefetch" href="/assets/js/46.359760e9.js"><link rel="prefetch" href="/assets/js/47.6f95684b.js"><link rel="prefetch" href="/assets/js/48.a43b234f.js"><link rel="prefetch" href="/assets/js/49.bab06cb1.js"><link rel="prefetch" href="/assets/js/50.7e676799.js"><link rel="prefetch" href="/assets/js/51.8ee22d62.js"><link rel="prefetch" href="/assets/js/52.cfb7ce7a.js"><link rel="prefetch" href="/assets/js/53.05490146.js"><link rel="prefetch" href="/assets/js/54.6f230790.js"><link rel="prefetch" href="/assets/js/55.e84add2b.js"><link rel="prefetch" href="/assets/js/56.4714565c.js"><link rel="prefetch" href="/assets/js/57.7b57b5f4.js"><link rel="prefetch" href="/assets/js/58.728d8184.js"><link rel="prefetch" href="/assets/js/59.78ebb42e.js"><link rel="prefetch" href="/assets/js/60.400d133e.js"><link rel="prefetch" href="/assets/js/61.394cc671.js"><link rel="prefetch" href="/assets/js/62.b33ca5fc.js"><link rel="prefetch" href="/assets/js/63.3d15725e.js"><link rel="prefetch" href="/assets/js/64.76825203.js"><link rel="prefetch" href="/assets/js/65.c868ff2e.js"><link rel="prefetch" href="/assets/js/66.80d45b6f.js"><link rel="prefetch" href="/assets/js/67.7eae91af.js"><link rel="prefetch" href="/assets/js/68.06a2d949.js"><link rel="prefetch" href="/assets/js/69.6355d227.js"><link rel="prefetch" href="/assets/js/7.6ecfe519.js"><link rel="prefetch" href="/assets/js/70.ff5e753b.js"><link rel="prefetch" href="/assets/js/71.f8e194e0.js"><link rel="prefetch" href="/assets/js/72.ea4d8f53.js"><link rel="prefetch" href="/assets/js/73.b5a5c5eb.js"><link rel="prefetch" href="/assets/js/74.ac1861f3.js"><link rel="prefetch" href="/assets/js/75.3e34dc1f.js"><link rel="prefetch" href="/assets/js/76.814bbe49.js"><link rel="prefetch" href="/assets/js/77.079e4dd1.js"><link rel="prefetch" href="/assets/js/78.3ccb46ac.js"><link rel="prefetch" href="/assets/js/79.d632088a.js"><link rel="prefetch" href="/assets/js/8.222ab8c9.js"><link rel="prefetch" href="/assets/js/80.7d8d7cb1.js"><link rel="prefetch" href="/assets/js/81.f147634a.js"><link rel="prefetch" href="/assets/js/82.dc6f855d.js"><link rel="prefetch" href="/assets/js/83.b90ba4db.js"><link rel="prefetch" href="/assets/js/84.765f864d.js"><link rel="prefetch" href="/assets/js/85.6e178f6d.js"><link rel="prefetch" href="/assets/js/86.2cd36f35.js"><link rel="prefetch" href="/assets/js/87.4d9e7568.js"><link rel="prefetch" href="/assets/js/88.061b8473.js"><link rel="prefetch" href="/assets/js/89.8d715627.js"><link rel="prefetch" href="/assets/js/9.334faa1a.js"><link rel="prefetch" href="/assets/js/90.9b330d8e.js"><link rel="prefetch" href="/assets/js/91.1e7d6010.js"><link rel="prefetch" href="/assets/js/92.612b2e49.js"><link rel="prefetch" href="/assets/js/93.6ee43dc4.js"><link rel="prefetch" href="/assets/js/94.e73a2469.js"><link rel="prefetch" href="/assets/js/95.dbbc0dad.js"><link rel="prefetch" href="/assets/js/96.dd16c729.js"><link rel="prefetch" href="/assets/js/97.cc5c3f8c.js"><link rel="prefetch" href="/assets/js/98.cbd15221.js"><link rel="prefetch" href="/assets/js/99.c7e7a198.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37721fd6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Enqueue Zero</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/soasme/enqueuezero" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/soasme/enqueuezero" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="job-queue"><a href="#job-queue" class="header-anchor">#</a> Job Queue</h1> <p></p><div class="table-of-contents"><ul><li><a href="#context">Context</a></li><li><a href="#overview">Overview</a></li><li><a href="#use">Use</a></li><li><a href="#common-pattern">Common Pattern</a><ul><li><a href="#setup-message-queue">Setup Message Queue</a></li><li><a href="#setup-queue-and-connection">Setup Queue and Connection</a></li><li><a href="#publish-the-job">Publish the job</a></li><li><a href="#dedicated-worker-as-consumer">Dedicated Worker as Consumer</a></li><li><a href="#monitoring">Monitoring</a></li><li><a href="#job-context">Job Context</a></li><li><a href="#result-storage">Result Storage</a></li><li><a href="#error-handling">Error Handling</a></li></ul></li><li><a href="#comparisons">Comparisons</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div><p></p> <h2 id="context"><a href="#context" class="header-anchor">#</a> Context</h2> <p>In request-response model server usually has  very short time to run transactions, and thus it doesn't have enough time to handle time-consuming jobs. For example, the web server needs to respond in less than 30 seconds, while an API importing his/her data might need to take 5 minutes.</p> <p>Job Queue is a general solution to solve the problem.</p> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>A Job queue, sometimes task queue or batch queue, is a data structure containing jobs to run outside the common request-response cycle.</p> <p>A job is a data structure containing running context, and usually encoded as strings or byte streams in job queue.</p> <p>A job producer initializes jobs, serializes them and sends them out. The producer can be the HTTP process, desktop GUI main process, or anything that is required to be responsive.</p> <p>A job consumer receives jobs from the job queue, deserializes them and runs jobs in isolated environment.</p> <h2 id="use"><a href="#use" class="header-anchor">#</a> Use</h2> <ul><li>Do offline calculations, for example, training machine learning models, updating loads of records in database, etc.</li> <li>Interact with third-party services, for example, sending emails or text messages.</li> <li>Let backup system do actual work without idling the compute resources.</li></ul> <h2 id="common-pattern"><a href="#common-pattern" class="header-anchor">#</a> Common Pattern</h2> <p>Below involves a set of popular job queue frameworks like Python-RQ, Celery, and Sidekiq. By comparing their APIs and design philosophies, we could have a deeper understanding of job queue.</p> <h3 id="setup-message-queue"><a href="#setup-message-queue" class="header-anchor">#</a> Setup Message Queue</h3> <p>First, run a Message Queue software. It can be Redis, RabbitMQ, ZeroMQ, Disque, etc. Without the Message Queue running, the publisher can't publish jobs and the consumer would very likely crash. However, Job Queue won't launch Message Queue for you usually, meaning you need to manually bring up Message Queue instance before running a Job Queue.</p> <h3 id="setup-queue-and-connection"><a href="#setup-queue-and-connection" class="header-anchor">#</a> Setup Queue and Connection</h3> <p>Job Queue usually requires you to define a <code>queue</code> object. The setup function usually needs the connection parameters of Message Queue and return the job queue object. This queue object encapsulates all functionalities a producer needs.</p> <p>For example, in Python-RQ,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> redis <span class="token keyword">import</span> Redis
<span class="token keyword">from</span> rq <span class="token keyword">import</span> Queue

rq <span class="token operator">=</span> Queue<span class="token punctuation">(</span>connection<span class="token operator">=</span>Redis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>For example, in Celery,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> celery <span class="token keyword">import</span> Celery

celery <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">,</span> broker<span class="token operator">=</span><span class="token string">'pyamqp://guest@localhost//'</span><span class="token punctuation">)</span>
</code></pre></div><p>Note that some frameworks many have already created a Job Queue so you only need to configure it. For example, in Sidekiq,</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">require</span> <span class="token string">'sidekiq'</span>

<span class="token constant">Sidekiq</span><span class="token punctuation">.</span>configure_server <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>redis <span class="token operator">=</span> <span class="token punctuation">{</span> url<span class="token punctuation">:</span> <span class="token string">'redis://redis.svc:6379/0'</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre></div><h3 id="publish-the-job"><a href="#publish-the-job" class="header-anchor">#</a> Publish the job</h3> <p>Almost all framework try to simplify the effort of publishing the job. The API has two common kinds:</p> <ul><li>Enqueue Plain Function</li> <li>Make Plain Function Asynchronous</li></ul> <p>###! Enqueue Plain Function</p> <p>Define plain function, and use the queue to enqueue function call.</p> <p>For example, in Python-RQ,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">count_words_at_url</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

rq<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>count_words_at_url<span class="token punctuation">,</span> <span class="token string">'https://enqueuezero.com'</span><span class="token punctuation">)</span>
</code></pre></div><p>###! Make Plain Function Asynchronous</p> <p>Decorate plain function with the queue to make it asynchronous.</p> <p>For example, in Celery,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@celery<span class="token punctuation">.</span>task</span>
<span class="token keyword">def</span> <span class="token function">count_words_at_url</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

count_words_at_url<span class="token punctuation">.</span>delay<span class="token punctuation">(</span><span class="token string">'https://enqueuezero.com'</span><span class="token punctuation">)</span>
</code></pre></div><p>For example, in Sidekiq,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CountWordsAtURLWorker</span>
  include Sidekiq<span class="token punctuation">:</span><span class="token punctuation">:</span>Worker
  <span class="token keyword">def</span> <span class="token function">perform</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token builtin">open</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> do <span class="token operator">|</span>r<span class="token operator">|</span>
        r<span class="token punctuation">.</span>read<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size
    end
  end
end

CountWordsAtURLWorker<span class="token punctuation">.</span>perform_async<span class="token punctuation">(</span><span class="token string">'https://enqueuezero.com'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="dedicated-worker-as-consumer"><a href="#dedicated-worker-as-consumer" class="header-anchor">#</a> Dedicated Worker as Consumer</h3> <p>Most Job Queue softwares take over the worker completely, meaning you only need to start the workers and let them run. The worker will start executing the job in the background on fetching one from MQ. You might want to run it as a daemon or under process supervisors.</p> <p>For example, in Python-RQ,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ pipenv run rq worker
</code></pre></div><p>For example, in Celery,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ pipenv run celery -A tasks worker
</code></pre></div><p>For example, in Sidekiq,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ bundle <span class="token builtin class-name">exec</span> sidekiq
</code></pre></div><h3 id="monitoring"><a href="#monitoring" class="header-anchor">#</a> Monitoring</h3> <p>Since Job Queue process runs in the background, so monitoring is a battery-included feature. It often provides you some job statistics like below:</p> <ul><li>How many jobs in progress, or failed.</li> <li>How many workers in idle, or busy.</li> <li>How many jobs it has handled.</li> <li>etc.</li></ul> <p>The Job Queue framework often provides two kinds of interfaces:</p> <ul><li>A command-line interface that can show job statistics, often with color bars.</li> <li>A web dashboard running in parallel with worker processes. This also requires to run an extra admin web process alongside with the Job Queue. The basic theory is to let the admin web process connect to Message Queue for statistics.</li></ul> <h3 id="job-context"><a href="#job-context" class="header-anchor">#</a> Job Context</h3> <p>Below lists some common seen job context data:</p> <ul><li><code>job.id</code> is a reference. We use it to query job context from Message Queue as well. UUID is usually to be the ID generator.</li> <li><code>job.function</code> is a reference of object that tells consumer how to run the job. It can be an import string, or a code object.</li> <li><code>job.args</code> are a list of parameters to be passed into Job functions.</li> <li><code>job.ttl</code>, or time-to-live, is the maximum time of job presenting. The job will be dropped or raise error if the TTL is exceeded. This is mainly to prevent job stuck in the queue.</li> <li><code>job.timeout</code> is the maximum time of job execution in worker.</li> <li><code>job.status</code> describes if the job is in running, or has run successfully, or failed, etc. The field status reflects the life cycle of a job.</li> <li><code>job.result</code> stores the return value of job function call.</li></ul> <h3 id="result-storage"><a href="#result-storage" class="header-anchor">#</a> Result Storage</h3> <p>Job functions may return values. Some Job Queue frameworks support storing results into a backend. Some frameworks simply have no support for result storage for it might increase the complexity of implementation. Anyway, since we have the job id in the context, it's quite easy to store the id-result into key-value database for the Job Queue. It requires setting a storage backend when the Job Queue is setup.</p> <h3 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error Handling</h3> <p>Job Queue has below solutions for failed jobs usually:</p> <ul><li>Customize error hook function.</li> <li>Log error tracebacks or integrate with Error Tracing system.</li> <li>Backoff and retry the job if necessary.</li> <li>Move dead jobs to a failed queue.</li></ul> <p>When job failed, it's unrealistic to keep trying running the job. It's usually the maintainer's responsibility to intervene, either to purge the job or fix the code and re-run the job.</p> <h2 id="comparisons"><a href="#comparisons" class="header-anchor">#</a> Comparisons</h2> <p>Below lists popular Job Queue frameworks.</p> <ul><li><a href="https://www.celeryproject.org/" target="_blank" rel="noopener noreferrer">Celery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>Popular.</li></ul></li> <li>Disadvantages
<ul><li>Over-engineering. Do you really need Celery? Give Python-RQ a look.</li> <li>Complex dependencies and code layers.</li> <li>Hard to debug.</li> <li>Complicated configuration.</li> <li>Can build an async call hell if you wish.</li></ul></li></ul></li> <li><a href="https://python-rq.org/" target="_blank" rel="noopener noreferrer">Python-RQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>Simple, all document read through in 15min.</li> <li>Easy to debug.</li></ul></li> <li>Disadvantages
<ul><li>Support only Redis as broker.</li> <li>No delayed jobs. Do you think RQ is enough for you? Give celery a look.</li> <li>Unreliable delivery.</li></ul></li></ul></li> <li><a href="https://dramatiq.io/" target="_blank" rel="noopener noreferrer">Dramatiq<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>Simple.</li> <li>Kinda in the middle of Python-RQ and Celery.</li> <li>Task prioritization.</li> <li>Rate limiting.</li> <li>Can retry.</li></ul></li> <li>Disadvantages
<ul><li>Limited Message Queue broker choices.</li></ul></li></ul></li> <li><a href="https://github.com/dcramer/taskmaster" target="_blank" rel="noopener noreferrer">Taskmaster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>designed for handling one-off tasks with large sets of tasks</li></ul></li> <li>Disadvantages
<ul><li>Poor document</li></ul></li></ul></li> <li><a href="https://sidekiq.org/" target="_blank" rel="noopener noreferrer">Sidekiq<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>Popular</li> <li>Rich document</li></ul></li> <li>Disadvantages
<ul><li>thread unsafety</li></ul></li></ul></li> <li><a href="https://resque.github.io/" target="_blank" rel="noopener noreferrer">Resque<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>Beautiful web dashboard</li> <li>Simple</li></ul></li> <li>Disadvantages
<ul><li>Support only Redis as broker.</li></ul></li></ul></li> <li><a href="https://github.com/collectiveidea/delayed_job" target="_blank" rel="noopener noreferrer">DelayedJob<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Advantages
<ul><li>Easy to use</li> <li>Good Rails integration</li></ul></li> <li>Disadvantages
<ul><li>Performance</li></ul></li></ul></li></ul> <p>Other solutions:</p> <ul><li><a href="https://github.com/brandonhilkert/sucker_punch" target="_blank" rel="noopener noreferrer">Sucker Punch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/mperham/girl_friday" target="_blank" rel="noopener noreferrer">Girl Friday<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://jqm.readthedocs.io/en/master/" target="_blank" rel="noopener noreferrer">JQM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/bee-queue/bee-queue" target="_blank" rel="noopener noreferrer">Bee-Queue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/OptimalBits/bull" target="_blank" rel="noopener noreferrer">Bull<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Automattic/kue" target="_blank" rel="noopener noreferrer">Kue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>Job queue is an essential component to extend request-response model for handling time-consuming jobs. Choose a Job Queue framework that has API and features you like, and make sure that you have solutions to overcome the disadvantages.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/soasme/enqueuezero/edit/master/architecture/job-queue.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0bd1d501.js" defer></script><script src="/assets/js/6.380ebf0c.js" defer></script><script src="/assets/js/30.5b7db60c.js" defer></script>
  </body>
</html>
